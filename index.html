<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Volerx | منتجاتي</title>
<link rel="icon" href="https://i.postimg.cc/9FR514MS/38CF47CD-3735-4111-8683-B0AC11C51C59.png">

<style>
:root {
  --bg: #0f0f0f;
  --card: #ffffff;
  --text-dark: #000;
  --text-light: #fff;
}

* {
  box-sizing: border-box;
  font-family: system-ui, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text-light);
}

header {
  text-align: center;
  padding: 20px;
  font-size: 22px;
  font-weight: bold;
}

.hidden { display: none; }

.back-btn {
  position: fixed;
  top: 15px;
  left: 15px;
  font-size: 22px;
  cursor: pointer;
  z-index: 10;
}

#categories, #products {
  padding: 20px;
  display: grid;
  gap: 20px;
}

#categories {
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
}

.category-card {
  background: var(--card);
  color: var(--text-dark);
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
}

.category-card img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  animation: slide 6s infinite;
}

.category-name {
  padding: 10px;
  font-weight: bold;
  text-align: center;
}

@keyframes slide {
  0% { opacity: 1; }
  33% { opacity: 0.7; }
  66% { opacity: 0.9; }
}

#products {
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.product-card {
  background: var(--card);
  color: var(--text-dark);
  border-radius: 12px;
  padding: 10px;
}

.product-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 8px;
  cursor: pointer;
}

.product-name {
  margin-top: 8px;
  font-weight: bold;
}

.product-price {
  color: #444;
}

/* Modal */
#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
}

#modal img {
  max-width: 90%;
  max-height: 90%;
}

#closeModal {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 26px;
  color: white;
  cursor: pointer;
}
</style>
</head>

<body>

<header id="title">منتجات Volerx</header>
<div class="back-btn hidden" id="backBtn">←</div>

<div id="loading">⏳ جاري تحميل المنتجات…</div>

<div id="categories"></div>
<div id="products" class="hidden"></div>

<div id="modal" class="hidden">
  <div id="closeModal">✕</div>
  <img id="modalImg">
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTlN-9WaF9E7jxo836CniVtu6NG1BFJONmi34JAibeRyo1WXtuaW0fpoPz5Ntv8s4eUfmrKIq22CRlS/pub?gid=1564525727&single=true&output=csv";

const categoriesDiv = document.getElementById("categories");
const productsDiv = document.getElementById("products");
const loading = document.getElementById("loading");
const backBtn = document.getElementById("backBtn");
const title = document.getElementById("title");

let allProducts = [];

fetch(SHEET_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1);
    rows.forEach(row => {
      const [ , name, price, image, category ] = row.split(",");
      if(name && image && category){
        allProducts.push({name, price, image, category});
      }
    });
    loading.remove();
    showCategories();
  });

function showCategories(){
  title.textContent = "منتجات Volerx";
  categoriesDiv.innerHTML = "";
  categoriesDiv.classList.remove("hidden");
  productsDiv.classList.add("hidden");
  backBtn.classList.add("hidden");

  const groups = {};
  allProducts.forEach(p => {
    if(!groups[p.category]) groups[p.category] = [];
    groups[p.category].push(p);
  });

  for(const cat in groups){
    const card = document.createElement("div");
    card.className = "category-card";

    const img = document.createElement("img");
    img.src = groups[cat][0].image;

    const name = document.createElement("div");
    name.className = "category-name";
    name.textContent = cat;

    card.append(img, name);
    card.onclick = () => showProducts(cat);

    categoriesDiv.appendChild(card);
  }
}

function showProducts(category){
  history.pushState({}, "", "#"+category);
  title.textContent = category + " | Volerx";
  backBtn.classList.remove("hidden");

  categoriesDiv.classList.add("hidden");
  productsDiv.classList.remove("hidden");
  productsDiv.innerHTML = "";

  allProducts.filter(p => p.category === category)
    .forEach(p => {
      const card = document.createElement("div");
      card.className = "product-card";

      const img = document.createElement("img");
      img.src = p.image;
      img.onclick = () => openModal(p.image);

      card.innerHTML = `
        <div class="product-name">${p.name}</div>
        <div class="product-price">${p.price} ₪</div>
      `;

      card.prepend(img);
      productsDiv.appendChild(card);
    });
}

backBtn.onclick = () => {
  history.back();
  showCategories();
};

window.onpopstate = () => showCategories();

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

function openModal(src){
  modalImg.src = src;
  modal.classList.remove("hidden");
}

document.getElementById("closeModal").onclick = () =>
  modal.classList.add("hidden");
</script>

</body>
</html>
